<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LostOS: src/kernel/mm/vmm.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LostOS
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_cbd7f246bdf7dc0a50281a272327e6ed.html">kernel</a></li><li class="navelem"><a class="el" href="dir_80965eb3ba1160063c01e5ec79f497d2.html">mm</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">vmm.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="vmm_8h_source.html">mm/vmm.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="pmm_8h_source.html">mm/pmm.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="utility_8h_source.html">common/utility.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="interrupt_8h_source.html">interrupts/interrupt.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="printf_8h_source.html">debug_utils/printf.h</a>&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:acb06b7c4006a14240ac29a3ede114daf"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmm_8c.html#acb06b7c4006a14240ac29a3ede114daf">vMapPage</a> (void *phys, void *virt, uint32_t flags)</td></tr>
<tr class="separator:acb06b7c4006a14240ac29a3ede114daf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a409b57cb773a4d7a57f99db96b204788"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmm_8c.html#a409b57cb773a4d7a57f99db96b204788">vUnmapPage</a> (void *virt)</td></tr>
<tr class="separator:a409b57cb773a4d7a57f99db96b204788"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd34cb4c1016f8b955c09153679bc1ec"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vmm_8c.html#acd34cb4c1016f8b955c09153679bc1ec">init_vmm</a> ()</td></tr>
<tr class="separator:acd34cb4c1016f8b955c09153679bc1ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="acd34cb4c1016f8b955c09153679bc1ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd34cb4c1016f8b955c09153679bc1ec">&#9670;&nbsp;</a></span>init_vmm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init_vmm </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The Virtual Memory Manager is going to start and handle paging in the system.</p>
<p>Paging is a system which allows each process to see a full virtual address space, without actually requiring the full amount of physical memory to be available or present. Maximum address space for 32 bit systems like this is 4GB.</p>
<p>The topmost paging structure is the PAGE DIRECTORY. It is essentially an array of page directory entries that take the following form:</p><ul>
<li>31_12 Page Table 4KB aligned address</li>
<li>11_8 Available</li>
<li>7_0 Flags<ul>
<li>7 G_Ignored</li>
<li>6 S_Page_Size</li>
<li>5 A_Accessed</li>
<li>4 D_Cache_Disable</li>
<li>3 W_Write_Through</li>
<li>2 U_User</li>
<li>1 R_Read</li>
<li>0 P_Present</li>
</ul>
</li>
</ul>
<p>In each PAGE TABLE, as it is, there are also 1024 entries. These are called page table entries, and are very similar to page directory entries:</p><ul>
<li>31_12 Physical Page 4KB aligned address</li>
<li>11_9 Available</li>
<li>7_0 Flags<ul>
<li>7 G_Global</li>
<li>6 D_Dirty</li>
<li>5 A_Accessed</li>
<li>4 D_Cache_Disable</li>
<li>3 W_Write_Through</li>
<li>2 U_User</li>
<li>1 R_Read</li>
<li>0 P_Present</li>
</ul>
</li>
</ul>
<p>This is the format of a 32 bit x86 virtual address: AAAAAAAAAA BBBBBBBBBB CCCCCCCCCCCC directory index page table index offset into page </p>
<p>Using the 'recursive mapping' technique. It consists in mapping the last entry in the page directory to the page directory iteself. The physical address of the page directory is in the registry 'cr3' and it's more helpful having it at the virtual address 0xFFFFF000.</p>
<p>This becomes more important when each process gets its own page directory, which can be anywhere in memory.</p>

</div>
</div>
<a id="acb06b7c4006a14240ac29a3ede114daf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb06b7c4006a14240ac29a3ede114daf">&#9670;&nbsp;</a></span>vMapPage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool vMapPage </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>phys</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>virt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The CPU pushes an error code on the stack before firing a page fault exception. The error code must be analyzed by the exception handler to determine how to handle the exception. The bottom 3 bits of the exception code are the only ones used, bits 3-31 are reserved.</p>
<p>The combination of these flags specify the details of the Page Fault and indicate what action to take:</p>
<p>US RW P - Description 0 0 0 - Supervisory process tried to read a non-present page entry 0 0 1 - Supervisory process tried to read a page and caused a protection fault 0 1 0 - Supervisory process tried to write to a non-present page entry 0 1 1 - Supervisory process tried to write a page and caused a protection fault 1 0 0 - User process tried to read a non-present page entry 1 0 1 - User process tried to read a page and caused a protection fault 1 1 0 - User process tried to write to a non-present page entry 1 1 1 - User process tried to write a page and caused a protection fault Mapping a virtual address to a physical one. </p>

</div>
</div>
<a id="a409b57cb773a4d7a57f99db96b204788"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a409b57cb773a4d7a57f99db96b204788">&#9670;&nbsp;</a></span>vUnmapPage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vUnmapPage </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>virt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Unmapping the virtual address from the current page directory. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
