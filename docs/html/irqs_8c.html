<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LostOS: src/kernel/interrupts/irqs.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LostOS
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_cbd7f246bdf7dc0a50281a272327e6ed.html">kernel</a></li><li class="navelem"><a class="el" href="dir_28eb04e9df1311571808062ef119429a.html">interrupts</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">irqs.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="irqs_8h_source.html">interrupts/irqs.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="idt_8h_source.html">tables/idt.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="printf_8h_source.html">debug_utils/printf.h</a>&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aadf5ae2109fe28b014720deb24f677de"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="irqs_8c.html#aadf5ae2109fe28b014720deb24f677de">irqs_init</a> ()</td></tr>
<tr class="separator:aadf5ae2109fe28b014720deb24f677de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5ebdc1b31b3357377b0257473641ced"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="irqs_8c.html#ab5ebdc1b31b3357377b0257473641ced">pic_init</a> ()</td></tr>
<tr class="separator:ab5ebdc1b31b3357377b0257473641ced"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad02536ed6e929d20694fa72d3f393461"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="irqs_8c.html#ad02536ed6e929d20694fa72d3f393461">irq_faultHandler</a> (regs_t *r)</td></tr>
<tr class="separator:ad02536ed6e929d20694fa72d3f393461"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af62fec9ecb95472ec14315a9e161103a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="irqs_8c.html#af62fec9ecb95472ec14315a9e161103a">irq_installHandler</a> (int irq, void(*handler)(regs_t *r))</td></tr>
<tr class="separator:af62fec9ecb95472ec14315a9e161103a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99a28bd3e9237b07826af4106d69929e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="irqs_8c.html#a99a28bd3e9237b07826af4106d69929e">irq_uninstallHandler</a> (int irq)</td></tr>
<tr class="separator:a99a28bd3e9237b07826af4106d69929e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a45ca926ab6a2861be80e892495b57bf1"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="irqs_8c.html#a45ca926ab6a2861be80e892495b57bf1">irq_routines</a> []</td></tr>
<tr class="separator:a45ca926ab6a2861be80e892495b57bf1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="ad02536ed6e929d20694fa72d3f393461"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad02536ed6e929d20694fa72d3f393461">&#9670;&nbsp;</a></span>irq_faultHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void irq_faultHandler </td>
          <td>(</td>
          <td class="paramtype">regs_t *&#160;</td>
          <td class="paramname"><em>r</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Each of the IRQ ISRs point to this function, rather than the 'isr_faultHandler' in '<a class="el" href="isrs_8c.html">isrs.c</a>'. The IRQ Controllers need to be told when you are done servicing them, so you need to send them an "End of Interrupt" command (0x20). There are two 8259 chips:</p><ul>
<li>The first exists at 0x20,</li>
<li>the second exists at 0xA0. If the second controller (an IRQ from 8 to 15) gets an interrupt, you need to acknowledge the interrupt at BOTH controllers, otherwise, you only send an EOI command to the first controller. If you don't send an EOI, you won't raise any more IRQs. </li>
</ul>
<p>If the IDT entry that was invoked was greater than 40 (meaning IRQ8 - 15), then we need to send an EOI to the slave controller</p>

</div>
</div>
<a id="af62fec9ecb95472ec14315a9e161103a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af62fec9ecb95472ec14315a9e161103a">&#9670;&nbsp;</a></span>irq_installHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void irq_installHandler </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>irq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(regs_t *r)&#160;</td>
          <td class="paramname"><em>handler</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This installs a custom IRQ handler for the given IRQ</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="irqs_8c.html#a99a28bd3e9237b07826af4106d69929e">irq_uninstallHandler()</a> </dd></dl>

</div>
</div>
<a id="a99a28bd3e9237b07826af4106d69929e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99a28bd3e9237b07826af4106d69929e">&#9670;&nbsp;</a></span>irq_uninstallHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void irq_uninstallHandler </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>irq</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This clears the handler for a given IRQ</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="irqs_8c.html#af62fec9ecb95472ec14315a9e161103a">irq_installHandler()</a> </dd></dl>

</div>
</div>
<a id="aadf5ae2109fe28b014720deb24f677de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aadf5ae2109fe28b014720deb24f677de">&#9670;&nbsp;</a></span>irqs_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void irqs_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ab5ebdc1b31b3357377b0257473641ced"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5ebdc1b31b3357377b0257473641ced">&#9670;&nbsp;</a></span>pic_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pic_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Normally, IRQs 0 to 7 are mapped to entries 8 to 15. This is a problem in protected mode, because IDT entry 8 is a Double Fault! Without remapping, every time IRQ0 fires, you get a Double Fault Exception, which is NOT actually what's happening. We send commands to the Programmable Interrupt Controller (PICs - also called the 8259's) in order to make IRQ0 to 15 be remapped to IDT entries 32 to 47 </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a45ca926ab6a2861be80e892495b57bf1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45ca926ab6a2861be80e892495b57bf1">&#9670;&nbsp;</a></span>irq_routines</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* irq_routines[]</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">    0, 0, 0, 0, 0, 0, 0, 0,</div><div class="line">    0, 0, 0, 0, 0, 0, 0, 0</div><div class="line">}</div></div><!-- fragment --><p>Array of function pointers: these are the actual irq routines. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
